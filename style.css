<?php 
session_start();
include 'connect.php';

if(isset($_POST['signUp'])){
    $firstName = $_POST['fName'];
    $lastName = $_POST['lName'];
    $email = $_POST['email'];
    $password = md5($_POST['password']);

    $checkEmail = "SELECT * FROM users WHERE email='$email'";
    $result = $conn->query($checkEmail);
    if($result->num_rows > 0){
        $error = "Email Address Already Exists!";
    } else {
        $insertQuery = "INSERT INTO users(firstName,lastName,email,password) VALUES ('$firstName','$lastName','$email','$password')";
        if($conn->query($insertQuery) === TRUE){
            header("Location: index.php");
            exit();
        } else {
            $error = "Error: " . $conn->error;
        }
    }
}

if(isset($_POST['signIn'])){
    $email = $_POST['email'];
    $password = md5($_POST['password']);
    $sql = "SELECT * FROM users WHERE email='$email' AND password='$password'";
    $result = $conn->query($sql);
    if($result->num_rows > 0){
        $row = $result->fetch_assoc();
        $_SESSION['email'] = $row['email'];
        header("Location: homepage.php");
        exit();
    } else {
        $error = "Incorrect Email or Password";
    }
}
?>

<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Register & Login</title>
<style>
  * {
    margin:0; padding:0; box-sizing:border-box; font-family: "Poppins", sans-serif;
  }
  body {
    background: linear-gradient(to right, #e2e2e2, #c9d6ff);
    background-color: #c9d6ff;
  }
  .container {
    background:#fff;
    width: 450px;
    padding: 1.5rem;
    margin: 50px auto;
    border-radius: 10px;
    box-shadow: 0 20px 35px rgba(0,0,1,0.9);
  }
  form {
    margin: 0 2rem;
  }
  .form-title {
    font-size: 1.5rem;
    font-weight: bold;
    text-align: center;
    padding: 1.3rem;
    margin-bottom: 0.4rem;
  }
  input {
    width: 100%;
    background-color: transparent;
    border: none;
    border-bottom: 1px solid #757575;
    padding-left: 1.5rem;
    font-size: 15px;
    color: inherit;
  }
  .input-group {
    padding: 1% 0;
    position: relative;
  }
  input:focus {
    background-color: transparent;
    outline: none;
    border-bottom: 2px solid hsl(327,90%,28%);
  }
  label {
    color: #757575;
    position: relative;
    left: 1.2em;
    top: -1.3em;
    cursor: auto;
    transition: 0.3s ease all;
  }
  input:focus ~ label,
  input:not(:placeholder-shown) ~ label {
    top: -3em;
    color: hsl(327,90%,28%);
    font-size: 15px;
  }
  .btn {
    font-size: 1.1rem;
    padding: 8px 0;
    border-radius: 5px;
    outline: none;
    border: none;
    width: 100%;
    background: rgb(125,125,235);
    color: white;
    cursor: pointer;
    transition: 0.9s;
  }
  .btn:hover {
    background: #07001f;
  }
  .or {
    font-size: 1.1rem;
    margin-top: 0.5rem;
    text-align: center;
  }
  .links {
    display: flex;
    justify-content: space-around;
    padding: 0 4rem;
    margin-top: 0.9rem;
    font-weight: bold;
  }
  button {
    color: rgb(125,125,235);
    border: none;
    background-color: transparent;
    font-size: 1rem;
    font-weight: bold;
    cursor: pointer;
  }
  button:hover {
    text-decoration: underline;
    color: blue;
  }
  .error-message {
    color: red;
    text-align: center;
    margin-bottom: 1rem;
  }
</style>
</head>
<body>

<?php if(isset($error)): ?>
  <p class="error-message"><?= htmlspecialchars($error) ?></p>
<?php endif; ?>

<div class="container" id="signup" style="display:none;">
  <h1 class="form-title">Register</h1>
  <form method="post" action="">
    <div class="input-group">
      <input type="text" name="fName" id="fName" placeholder="First Name" required autocomplete="off" />
      <label for="fName">First Name</label>
    </div>
    <div class="input-group">
      <input type="text" name="lName" id="lName" placeholder="Last Name" required autocomplete="off" />
      <label for="lName">Last Name</label>
    </div>
    <div class="input-group">
      <input type="email" name="email" id="email" placeholder="Email" required autocomplete="off" />
      <label for="email">Email</label>
    </div>
    <div class="input-group">
      <input type="password" name="password" id="password" placeholder="Password" required autocomplete="off" />
      <label for="password">Password</label>
    </div>
    <input type="submit" class="btn" value="Sign Up" name="signUp" />
  </form>
  <p class="or">----------or----------</p>
  <div class="links">
    <p>Already have an account?</p>
    <button id="signInButton">Sign In</button>
  </div>
</div>

<div class="container" id="signIn">
  <h1 class="form-title">Sign In</h1>
  <form method="post" action="">
    <div class="input-group">
      <input type="email" name="email" id="email" placeholder="Email" required autocomplete="off" />
      <label for="email">Email</label>
    </div>
    <div class="input-group">
      <input type="password" name="password" id="password" placeholder="Password" required autocomplete="off" />
      <label for="password">Password</label>
    </div>
    <input type="submit" class="btn" value="Sign In" name="signIn" />
  </form>
  <p class="or">----------or----------</p>
  <div class="links">
    <p>Don't have an account?</p>
    <button id="signUpButton">Sign Up</button>
  </div>
</div>

<script>
  const signUpButton = document.getElementById('signUpButton');
  const signInButton = document.getElementById('signInButton');
  const signInForm = document.getElementById('signIn');
  const signUpForm = document.getElementById('signup');

  signUpButton.addEventListener('click', function() {
    signInForm.style.display = "none";
    signUpForm.style.display = "block";
  });

  signInButton.addEventListener('click', function() {
    signInForm.style.display = "block";
    signUpForm.style.display = "none";
  });
  .top-bar {
  width: 100%;
  padding: 10px 20px;
  background-color: #07001f;
  position: fixed;
  top: 0;
  left: 0;
  z-index: 1000;
  display: flex;
  justify-content: flex-end;
}

.right-buttons a.btn-top {
  color: white;
  background: rgb(125,125,235);
  padding: 8px 16px;
  margin-left: 10px;
  text-decoration: none;
  border-radius: 5px;
  font-weight: bold;
  transition: 0.3s;
}

.right-buttons a.btn-top:hover {
  background: #ffffff;
  color: #07001f;
}

</script>

</body>
</html>
